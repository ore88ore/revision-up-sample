version: 0.1
frontend:
  phases:
    preBuild:
      commands:
        - yarn global add ulid
        - REVISION=`ulid`
        - APP_REVISION_ID=$REVISION yarn
    build:
      commands:
        - yarn generate
    postBuild:
      commands:
        - cp -rf static/* dist/
        - printf '{"revision":"%s"}' $REVISION | aws s3 cp - s3://$BUCKET_NAME/application/revision.json --content-type "application/json"
        - aws cloudfront create-invalidation --distribution-id $DISTRIBUTION_ID --paths "/application/*"
  artifacts:
    baseDirectory: dist/
    files:
      - '**/*'
